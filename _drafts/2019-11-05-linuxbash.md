---  
layout: post  
title:  "Shell脚本"
date:  2019-11-05 15:07:23
categories: ubuntu
tags: ubuntu
---  

* content  
{:toc}  

Linux中Shell作为用户管理的界面,接触和使用非常广泛,利用Bash脚本的自动化配置,可以方便快捷的完成系统的配置  
此外,Pixhawk飞控中的气动脚本nsh也很大程度上借鉴了linux的shell脚本,因此对于学习Pixhawk飞控也很有必要

### Shell的两种类型
- Bourne Shell:sh;ksh;Bash  
- C Shell:csh;tcsh  

Shell脚本第一行：  
```#!/bin/bash```

### Shell快捷键
- Ctrl+C 强制终止当前命令  
- Ctrl+L 清屏  
- Ctrl+A 光标移动到行首  
- Ctrl+E 光标移动到行尾  
- Ctrl+U 从光标所在位置删除到行首  
- Ctrl+Z 当前正在运行的命令放入后台运行  
- Ctrl+R 在历史命令中搜索  

### echo显示输出
```echo [选项] [输出内容]```  
-e 激活转义字符  
#### 转义字符：  
- \a 警告音  
- \b 退格键  
- \n 换行符  
- \r 回车  
- \t 制表符  
- \0nnn 按照八进制ASCII码表输出  
- \xhh 按照十六进制输出  

#### 输出颜色
```echo -e "\e[1;31m XXXXXXX \e[0m "```  
注意前面加-e选项  
颜色： 30m黑色 31m红色 32m绿色 33m黄色 34m蓝色 35m洋红 36m青色 37m白色  

### 输入输出重定向
标准输入输出设备：  
标准输入：键盘 /dev/stdin 0  
标准输出：显示器 /dev/stdout 1  
标准错误输出：显示器 /dev/stderr 2  
#### 输出重定向
标准输出重定向：  
```命令 > 文件``` 命令的正确输出覆盖到文件  
```命令 >> 文件``` 命令的正确输出追加到文件结尾  
```错误命令 2> 文件``` 命令的错误输出覆盖到文件  
```错误命令 2>> 文件``` 命令的错误输出追加到文件结尾  
正确输出和错误输出同时输出：  
覆盖：  
```命令 > 文件 2>&1```  
```命令 &> 文件```  
追加：  
```命令 >> 文件 2>&1```  
```命令 &>> 文件```  
分别输出到不同文件：  
```命令 >> 文件1 2>> 文件2```  
#### 输入重定向
< 文件输入重定向  
<< 标识符，使用双小于号会提示输入多行数据，直到遇到标识符才结束  

### 命令执行顺序
```命令1 ; 命令2``` 多个命令之间顺序执行  
```命令1 && 命令2``` 命令1正确执行时命令2才会执行  
```命令1 || 命令2``` 命令1执行错误时命令2才会执行  
```命令1 | 命令2``` 命令1的正确输出会作为命令2的输入

### 符号
- ```?```匹配单个字符  
- ```*```匹配零个或多个字符  
- ```[]```匹配括号内任意一个字符  
- ```[-]```匹配括号内一段字符  
- ```[^]```不匹配括号内字符段  

如匹配非数字字符：```[^0-9]```  

- ```' '``` 所有特殊符号都没有特殊意义  
- ```" "``` 双引号中```$ ` \```都有特殊意义  
- ```$( )``` 引用系统命令（命令会先执行） 等同于反引号  
- ```#``` 注释  
- ```$``` 调用变量的值  
- ```\``` 转义符  

### 变量
以字符或下划线开头，默认是字符串类型，不能进行数值运算  
默认分为三种：用户自定义变量；环境变量；预定义变量  
查看系统所有变量：```set```  
打开调用未声明变量时系统报错：```set -u```  
删除变量：```unset 变量名```  
#### 变量叠加
```bash
x=123
x="$x"456 #叠加一次
x=${x}789 #再叠加一次
```

#### 环境变量
用户变量只能再当前shell中生效，环境变量可以在shell和子shell中生效(全局变量)  
用户自定义环境变量：```export```  
查看系统变量：```env```  
配置文件 | 系统启动先后顺序 | 切换用户sudo先后顺序 | 作用
- | - | - | -
/etc/profile        | 1 |   | 登录时配置，设置USER,LOGNAME,MAIL,PATH,HOSTNAME,HISTSIZE,umask，调用/etc/profile.d/.sh
/etc/profile.d/*.sh | 2 | 2 |
~/.bash_profile     | 3 |   | 把$HOME/bin加入PATH
~/.bashrc           | 4 |   | 定义别名
/etc/bashrc         | 5 | 1 | PS1变量，umask，调用/etc/profile.d/.sh
注意，系统登录时各个配置文件顺序执行，依次调用下一个文件，如果其中某个文件删了或清空了，则之后的不会执行，可能出现奇奇怪怪的错误  
其他配置文件：
- ~/.bash_logout 系统注销时的配置文件
- ~/.bash_history 记录历史命令
- /etc/issue 本地终端登录前显示欢迎信息
- /etc/issue.net 远程终端登录前欢迎信息(此外注意在ssh的配置文件中开启)

##### PATH环境变量
系统默认可执行文件搜索路径  

##### PS1命令提示符设置  
- \d 日期  
- \H 完整主机名  
- \t 24小时制时分秒时间  
- \A 24小时制时分时间  
- \u 当前用户名  
- \w 当前所在目录完整名称  
- \W 当前所在目录(单个目录名称)  
- \\$ 提示符 root是# 普通用户$  
##### LANG语系变量
locale查询当前语系  
locale -a 查询所有语系  
可以修改LANG环境变量  

#### 预定义变量
##### 位置参数变量
- $n 表示命令的参数，$0代表命令本身，第十个以上的参数加大括号${10}  
- $* 获取所有参数，把整个命令行中所有参数看成一个整体  
- $@ 获取所有参数，把命令行中每个参数区分对待(在循环中使用)  
- $# 命令行参数个数  
- $? 上一个执行的命令的返航状态，如果是0，则为正确执行
- $$ 当前进程的进程号
- $! 后台运行的最后一个进程的进程号
##### 键盘输入read
```read -p "Please enter:" 变量名```  
-p 提示信息  
-t 指定等待时间  
-n 只接受指定的字符数  
-s 隐藏数据的数据(密码)

### 运算符
#### declare声明变量类型
```declare [+/-][选项] 变量名```  
```-```代表设定类型属性；```+```代表取消属性  
- -a 数组型
- -i 整型
- -x 环境变量
- -r 只读变量
- -p 显示变量被声明的类型

数组定义： 
```bash
group[0]=xx
group[1]=yy #系统自动设为数组
echo ${group} #调用第一个变量
echo ${group[1]}
echo ${group[*]} #调用所有变量
```

#### 数值运算
运算符优先级  
高
- -,+ 负 正
- !,~ 逻辑非 按位取反
- *,/,% 乘 除 取余
- +,- 加 减
- <<,>> 按位左移 按位右移
- <=,>=,<,> 大小比较
- ==,!= 等于 不等于
- & 按位与
- ^ 按位异或
- | 按位或
- && 逻辑与
- || 逻辑或
- =,+=...,|= 赋值 运算后赋值
```bash
a=1
b=2
declare -i c1=$a + $b
c2=$(expr $a + $b)
c3=$(($a + $b))
c4=$[$a + $b]
```

### 流程控制
#### 条件判断
两种形式
- test -e a.x
- [-e a.x]
中括号中加条件判断的语句   

##### 文件存在判断
判断文件是否存在(如果文件不存在则直接为否)
测试选项 | 作用
- | -
-d | 是否为目录文件
-e | 文件是否存在
-f | 是否为非目录文件
```bash
[-e a.x] && echo yes || echo no
```
##### 文件存在判断
判断文件是否有某种权限，不管是哪个用户(如果文件不存在则直接为否)
测试选项 | 作用
- | -
-r | 是否有读的权限
-w | 是否有写的权限
-x | 是否有执行的权限

##### 两文件比较
测试选项 | 作用
-|-
文件1 -nt 文件2 | 判断文件1修改时间是否比文件2新
文件1 -ot 文件2 | 文件1是否比文件2旧
文件1 -ef 文件2 | inode是否一致

##### 两整数比较
测试选项 | 作用
- | -
整数1 -eq 整数2 | 是否相等
整数1 -ne 整数2 | 是否不相等
整数1 -gt 整数2 | 是否大于
整数1 -lt 整数2 | 是否小于
整数1 -ge 整数2 | 是否大于等于
整数1 -le 整数2 | 是否小于等于
```[12 -eq 13] && echo yes || echo no``` 数值比较会把两个字符串识别为整数

##### 字符串比较
测试选项 | 作用
- | -
-z 字符串 | 字符串是否为空
-n 字符串 | 字符串是否为非空
字符串1 == 字符串2 | 是否相等
字符串1 != 字符串2 | 是否不相等

##### 多重条件
测试选项 | 作用
- | -
-a | 逻辑与
-o | 逻辑或
! | 逻辑非


#### if语句
单分支
```bash
if [条件判断]; then

fi

if [条件判断]
    then

fi
```
双分支
```bash
if [条件判断]
    then

    else

fi
```
多分支
```bash
if [条件判断1]
    then
        #满足条件1
elif [条件判断2]
    then
        #满足条件2
else
    #所有条件都不满足
fi
```

#### 多分支case语句
```bash
case $变量名 in
    "值1")
        
        ;;
    "值2")
        
        ;;
    "值3")
        
        ;;
    *)
        
;;
esac
```

#### for循环
```bash
for 变量 in 值1 值2 ...
    do

    done
```
```bash
for ((i=1;i<=100;i=i+1))
    do

    done
```

#### while循环
条件成立则循环
```bash
while [条件]
    do

    done
```

#### until循环
条件不成立则循环
```bash
until [条件]
    do

    done
```